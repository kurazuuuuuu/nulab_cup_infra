name: Trigger Unity Android CodeBuild

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  trigger-codebuild:
    runs-on: ubuntu-latest
    steps:
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
          aws-region: ap-northeast-1

      - name: Start CodeBuild
        run: |
          aws codebuild start-build \
            --project-name "${{ vars.CODEBUILD_PROJECT_NAME || 'unity-android-build' }}" \
            --environment-variables-override \
              name=RELEASE_TAG,value=${{ github.ref_name }},type=PLAINTEXT \
              name=GITHUB_REPO,value=${{ github.repository }},type=PLAINTEXT
